56
1, 2, 13, 14, 14, 15, 15, 17, 18, 19, 20, 21, 21, 22, 22, 34, 34, 36, 40, 40, 41, 44, 45, 46, 47, 51, 52, 53, 53, 54, 54, 58, 59, 65, 65, 66, 66, 76, 79, 79, 81, 85, 85, 86, 89, 89, 90, 90, 90, 91, 94, 94, 95, 95, 95, 96
#include "gd.h"
#include "gd_intern.h"


/**
 * Integer Ellipse functions (gdImageEllipse and gdImageFilledEllipse)
 * Function added by Pierre-Alain Joye 02/08/2003 (paj@pearfr.org)
 * See the ellipse function simplification for the equation
 * as well as the midpoint algorithm.
 */

void gdImageEllipse(gdImagePtr im, int mx, int my, int w, int h, int c)
{
  int x=0,mx1=0,mx2=0,my1=0,my2=0;
  long aq,bq,dx,dy,r,rx,ry,a,b;

  a=w>>1;
  b=h>>1;
  gdImageSetPixel(im,mx+a, my, c);
  gdImageSetPixel(im,mx-a, my, c);
  mx1 = mx-a;my1 = my;
  mx2 = mx+a;my2 = my;

  aq = a * a;
  bq = b * b;
  dx = aq << 1;
  dy = bq << 1;
  r  = a * bq;
  rx = r << 1;
  ry = 0;
  x = a;
  while (x > 0) {
    if (r > 0) {
      my1++;my2--;
      ry +=dx;
      r  -=ry;
    }
    if (r <= 0) {
      x--;
      mx1++;mx2--;
      rx -=dy;
      r  +=rx;
    }
    gdImageSetPixel(im,mx1, my1, c);
    gdImageSetPixel(im,mx1, my2, c);
    gdImageSetPixel(im,mx2, my1, c);
    gdImageSetPixel(im,mx2, my2, c);
  }
}

void gdImageFilledEllipse (gdImagePtr im, int mx, int my, int w, int h, int c)
{
  int x=0,mx1=0,mx2=0,my1=0,my2=0;
  long aq,bq,dx,dy,r,rx,ry,a,b;
  int i;
  int old_y2;

  a=w>>1;
  b=h>>1;

  for (x = mx-a; x <= mx+a; x++) {
    gdImageSetPixel(im, x, my, c);
  }

  mx1 = mx-a;my1 = my;
  mx2 = mx+a;my2 = my;

  aq = a * a;
  bq = b * b;
  dx = aq << 1;
  dy = bq << 1;
  r  = a * bq;
  rx = r << 1;
  ry = 0;
  x = a;
  old_y2=-2;
  while (x > 0) {
    if (r > 0) {
      my1++;my2--;
      ry +=dx;
      r  -=ry;
    }
    if (r <= 0) {
      x--;
      mx1++;mx2--;
      rx -=dy;
      r  +=rx;
    }
    if(old_y2!=my2) {
      for(i=mx1;i<=mx2;i++) {
        gdImageSetPixel(im,i,my1,c);
      }
    }
    if(old_y2!=my2) {
      for(i=mx1;i<=mx2;i++) {
        gdImageSetPixel(im,i,my2,c);
      }
    }
    old_y2 = my2;
  }
}


