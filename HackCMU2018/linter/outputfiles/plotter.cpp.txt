99
8, 10, 11, 12, 13, 14, 14, 14, 15, 16, 17, 18, 19, 20, 21, 22, 22, 23, 24, 24, 25, 25, 26, 26, 27, 28, 28, 28, 29, 30, 30, 30, 31, 32, 33, 34, 34, 34, 35, 36, 37, 38, 39, 40, 41, 41, 41, 42, 43, 43, 44, 45, 46, 46, 47, 48, 48, 49, 50, 50, 51, 52, 52, 52, 53, 54, 54, 54, 55, 56, 57, 57, 58, 58, 58, 59, 60, 61, 61, 62, 62, 62, 63, 64, 65, 66, 66, 66, 67, 68, 69, 70, 71, 72, 73, 73, 74, 75, 10
#include "plotter.hpp"
#ifdef _DEBUG
#include <iostream>
#endif
#include <cstdio>
#include <cfloat>

using namespace std;

void Plotter::plot (const std::vector<share_t>& shares)
{
	// FIXME: output and calculations
	if (!shares.size())
	{
		printf("There are no shares to plot?!\n");
		return;
	}
	float* values = shares.size() < 30 ? new float[shares.size()] : new float[30];
	float biggest = FLT_MIN;
	float smallest = FLT_MAX;
	float difference = 0.0f;
	const int width = shares.size() < 30 ? (int)shares.size() : 30;
	const int height = 20;
	char drawArea[height * width];
	memset((void*)&drawArea[0], ' ', height * width * sizeof(char));
	
	for (register int i = 0; i < width; i++)
	{
		if (biggest < shares[i].close)
		{
			biggest = shares[i].close;
		}
		if (smallest > shares[i].close)
		{
			smallest = shares[i].close;
		}
		values[i] = shares[i].close;
	}
	difference = biggest - smallest;
	for (register int i = width - 1; i >= 0; i--)
	{
		float newVal = values[i] - smallest;
		int position = 20 - (int)((newVal / difference) * 20.0f);
		drawArea[position * width + (width - i - 1)] = '*';
	}
	printf("=========================================================================\n");
	printf("%s shares from %d/%d/%d to %d/%d/%d\n", shares[0].name.c_str(),
		shares[width-1].date.month, shares[width-1].date.day, shares[width-1].date.year,
		shares[0].date.month, shares[0].date.day, shares[0].date.year);
	printf("=========================================================================\n");
	for (register int i = 0; i < height; i++)
	{
		if (i == 0)
		{
			printf("%05.1f |", biggest);
		}
		else if (i == (height - 1))
		{
			printf("%05.1f |", smallest);
		}
		else
		{
			printf("      |");
		}
		for (register int j = 0; j < width; j++)
		{
			printf("%c", drawArea[i * width + j]);
		}
		printf("\n");
	}
	printf("      +------------------------------\n");
	printf("    %d/%d/%d                 %d/%d/%d\n",
		shares[width-1].date.month, shares[width-1].date.day, shares[width-1].date.year,
		shares[0].date.month, shares[0].date.day, shares[0].date.year);
	delete[] values;
}
